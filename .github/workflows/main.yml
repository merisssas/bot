name: replacer

on:
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  replace:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Replace occurrences (exclude workflow files)
        shell: bash
        run: |
          set -euo pipefail

          FROM='krau/SaveAny-Bot'
          TO='merisssas/Bot'

          echo "Scanning for: $FROM"

          # Ambil file yang match, tapi exclude .github/workflows/**
          mapfile -t files < <(
            git grep -l -- "$FROM" \
              -- ':(exclude).github/workflows/**' \
            || true
          )

          if [ "${#files[@]}" -eq 0 ]; then
            echo "No matches found (after exclusions). Nothing to change."
            exit 0
          fi

          echo "Found ${#files[@]} file(s). Replacing..."
          for f in "${files[@]}"; do
            FROM="$FROM" TO="$TO" perl -pi -e 's/\Q$ENV{FROM}\E/$ENV{TO}/g' "$f"
          done

          echo "Replacement done. Showing diff:"
          git diff --stat

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          branch: chore/replace-krau-saveany-bot
          delete-branch: true
          commit-message: "chore: replace krau/SaveAny-Bot with merisssas/Bot"
          title: "chore: replace krau/SaveAny-Bot -> merisssas/Bot"
          body: |
            This PR replaces all occurrences of `krau/SaveAny-Bot` with `merisssas/Bot` across the repository.
            Excludes `.github/workflows/**` to avoid workflow-permission restrictions.
